<!-- /views/index.ejs -->

<%- include("partials/header.ejs") %>

<body>
  <div class="titleBlock">
    <img class="logo" src="https://cdn.onlinewebfonts.com/svg/img_81173.svg" alt="Dashboard icon">
    <h1>DashBoardSG</h1>
  </div>
  <div class="formBlock">
    <h2>What's important to you?</h2>
      
    <form id="myForm" action="/display" method="post">
      <div class="custom-control custom-checkbox">
        <label class="custom-control-label" for="weatherId">
          <input type="checkbox" class="custom-control-input" id="weatherId" name="Weather" value="selected" checked>Weather
        </label>

        <label class="custom-control-label" for="tempId">
          <input type="checkbox" class="custom-control-input" id="tempId" name="Temp" value="selected" checked>Temperature
        </label>

        <label class="custom-control-label" for="humidityId">
          <input type="checkbox" class="custom-control-input" id="humidityId" name="Humidity" value="selected" checked>Humidity
        </label>

        <label class="custom-control-label" for="rainfallId">
          <input type="checkbox" class="custom-control-input" id="rainfallId" name="Rainfall" value="selected">Rainfall
        </label>

        <label class="custom-control-label" for="pm25Id">
          <input type="checkbox" class="custom-control-input" id="pm25Id" name="PM25" value= "selected">PM2.5
        </label>

        <label class="custom-control-label" for="psiId">
          <input type="checkbox" class="custom-control-input" id="psiId" name="PSI" value="selected">PSI
        </label>

        <label class="custom-control-label" for="uviId">
          <input type="checkbox" class="custom-control-input" id="uviId" name="UVI" value="selected">UVI
        </label>

      </div>
      <br>
      <h3 id="browserWarning"></h3>
      <!-- <button class="btn btn-primary btn-lg" type="submit" id="locationButton" onmouseover="checkLocationPermission()"> -->
      <button class="btn btn-primary btn-lg" id="submitBtn" type="submit"><strong>Display</strong></button>
      <input type="hidden" id="userLatitude" name="userLatitude" value="latitude">
      <input type="hidden" id="userLongitude" name="userLongitude" value="longitude">
    </form>
  </div>
</body>

<script>
  let userLatitude, userLongitude;
  // const x = document.getElementById("browserWarning");

  // if (navigator.geolocation) {
  //   navigator.geolocation.getCurrentPosition(function(position) {
  //     userLatitude = position.coords.latitude;
  //     userLongitude = position.coords.longitude;
  //     document.querySelector("#userLatitude").value = userLatitude;
  //     document.querySelector("#userLongitude").value = userLongitude;
  //   });
  //   } else {
  //     console.log("Geolocation is not supported by this browser.");
  //     document.querySelector("#browserWarning").innerHTML = "Please enable location on this browser";
  //   }

  // if ("geolocation" in navigator) {
  //   navigator.permissions.query({ name: 'geolocation' }).then((result) => {
  //     const browserWarning = document.getElementById('browserWarning');
  //     if (result.state === 'denied') {
  //         // Location denied, show warning
  //         browserWarning.innerText = "Please enable location on this browser";
  //     } else {
  //         // Location allowed, hide warning
  //         browserWarning.innerText = "Thank you for enabling location on browser";
  //     }
  //   });
  // }

  // function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        function(position) {
          const userLatitude = position.coords.latitude;
          const userLongitude = position.coords.longitude;
          document.getElementById("userLatitude").value = userLatitude;
          document.getElementById("userLongitude").value = userLongitude;
          document.getElementById("browserWarning").innerHTML = "";
          document.getElementById("submitBtn").disabled = false;
        },
        function(error) {
            if (error.code === error.PERMISSION_DENIED) {
              // Handle permission denied
              document.getElementById("browserWarning").innerHTML = "Please enable location on this browser";
              document.getElementById("submitBtn").disabled = true;
              console.log("Location permission denied by user.");
            } else {
              // Handle other errors
              console.log("Geolocation is not supported by this browser.");
              console.error(`Error getting location: ${error.message}`);
            }
        }
      );
    } else {
      console.log("Geolocation is not supported by this browser.");
    }
  // }

  if (typeof(Storage) !== "undefined") {
  // Code for localStorage/sessionStorage.
    const dashBoard = ["weatherId", "tempId", "humidityId", "rainfallId", "pm25Id", "psiId", "uviId"];
    // Check if each item in localStorage.dashBoard is null
    const allNull = dashBoard.every(item => localStorage.getItem(item) === null);
    console.log(allNull);
    if (allNull) {
      dashBoard.forEach(item => localStorage.setItem(item, true));
    } else {
      dashBoard.forEach(item => document.getElementById(item).checked = localStorage.getItem(item);
    }
  } else {
  // Sorry! No Web Storage support..
  }
</script>


<%- include("partials/footer.ejs") %>
